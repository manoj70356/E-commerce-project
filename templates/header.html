<style>
.related-search-box {
    background: #f8f9fa;
    padding: 10px 15px;
    margin-top: 18px;
    border-radius: 6px;
    border: 1px solid #ddd;
}
.related-search-box h4 {
    margin-bottom: 10px;
}
.related-search-box ul {
    list-style: none;
    padding: 0;
}
.related-search-box li {
    margin-bottom: 5px;
}
.related-search-box a {
    color: #007bff;
    text-decoration: none;
}
.related-search-box a:hover {
    text-decoration: underline;
}
</style>


{% load static %}

<header class="py-4 shadow-sm bg-white">
    <div class="container flex items-center justify-between">

        <!-- Logo -->
        <a href="/">
            <img src="{% static 'images/logo.svg' %}" alt="Logo" class="w-32">
        </a>

        <!-- Search Bar -->
        <div class="w-full max-w-xl relative flex flex-col">

            <form method="GET" action="{% url 'search' %}" class="flex w-full">
                <span class="absolute left-4 top-3 text-lg text-gray-400 pointer-events-none">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </span>

                <input type="text" name="keyword" id="search"
                    class="w-full border border-primary border-r-0 pl-12 py-3 pr-3 rounded-l-md focus:outline-none"
                    placeholder="Search" value="{{ request.GET.keyword }}">
                
                <button type="submit"
                    class="bg-primary border border-primary text-white px-8 rounded-r-md hover:bg-transparent hover:text-primary transition">
                    Search
                </button>
            </form>

            <!-- Live Suggestion Dropdown -->
            <div id="suggestions-box"
                class="absolute top-14 left-0 w-full bg-white border border-gray-300 rounded-md shadow hidden z-50">
            </div>


            <!-- END Recommended -->
        </div>

        <!-- Right Menu -->
        <div class="flex items-center space-x-4">

            <!-- Cart -->
            <a href="{% url 'cart' %}" class="text-center text-gray-700 hover:text-primary transition relative">
                <div class="text-2xl"><i class="fa-solid fa-bag-shopping"></i></div>
                <div class="text-xs leading-3">Cart</div>
                <div
                    class="absolute -right-3 -top-1 w-5 h-5 rounded-full flex items-center justify-center bg-primary text-white text-xs">
                    {{ cart_count }}
                </div>
            </a>
            <!-- Account -->
            <a href="#" class="text-center text-gray-700 hover:text-primary transition">
                <div class="text-2xl"><i class="fa-regular fa-user"></i></div>
                <div class="text-xs leading-3">Account</div>
            </a>
        </div>

    </div>
</header>

<script>
const searchInput = document.getElementById("search");
const suggestionBox = document.getElementById("suggestions-box");

searchInput.addEventListener("keyup", function () {
    let query = this.value.trim();

    if (query.length === 0) {
        suggestionBox.classList.add("hidden");
        suggestionBox.innerHTML = "";
        return;
    }

    fetch(`{% url 'live_search' %}?keyword=${query}`)
        .then(res => res.json())
        .then(data => {
            let suggestions = data.suggestions;

            if (suggestions.length > 0) {
                suggestionBox.innerHTML = suggestions.map(item => `
                    <div class="px-4 py-2 hover:bg-gray-200 cursor-pointer suggestion-item"
                         onclick="selectSuggestion('${item}')">
                        ${item}
                    </div>
                `).join("");

                suggestionBox.classList.remove("hidden");
            } else {
                suggestionBox.classList.add("hidden");
                suggestionBox.innerHTML = "";
            }
        });
});

function selectSuggestion(text) {
    searchInput.value = text;
    suggestionBox.classList.add("hidden");
    searchInput.form.submit();
}

</script>

